/*!
 * uniGUI Library extension for Ext JS
 * by Farshad Mohajeri  
 * Copyright(c) 2009-2017 FMSoft Inc.
 * info@fmsoft.net
 * http://www.unigui.com
 !*/
var uniVars={mKeys:{},gNavigate:{},_docKeys_:{},_actFrm_:null,_mFrm_:null,_actPge_:{Id1:"",Id2:""},_mouseMove_:null,_mouseUp_:null,_mouseThis_:null,_maskObjs:[],_maskCnt:0,_actCnt:null,_extVer:null,_dlfrmarr:[],_dlfrmid:0,_vport:null,_timers:{},},uniWhiteMask={ldMask:true,maskUseMsg:false,maskAttribs:{color:"#fff",opacity:0.3}};function _dts_(a){if(a&&a.getDate){return(Ext.Date.format(a,"YmdHis"))}else{return("")}}function _ts_(a){if(a&&a.getDate){return(Ext.Date.format(a,"H:i:s"))}else{return(a)}}function _xl_(a){var b=encodeURIComponent;if(a==undefined||a===null){a=""}if(a&&a.getDate){return("\3d\3"+_dts_(a))}if(typeof a=="boolean"){return("\3b\3"+b(a))}return(b(a))}function _ds_(a){if(a&&a.getDate){return(Ext.Date.format(a,"Ymd"))}else{return("")}}function _ueval(ss){eval(ss)}function applyAttribs(a,b){if(a&&a.dom&&b.uniAttribs){a.dom.style.backgroundColor=b.uniAttribs.color;a.dom.style.opacity=b.uniAttribs.opacity}}Ext.override(Ext.LoadMask,{onRender:function(){this.callParent(arguments);var a=this.maskEl;applyAttribs(a,this)}});function _pss_(c,b){if(typeof c.shiftKey=="boolean"){var a=0;if(c.shiftKey){a|=1}if(c.altKey){a|=2}if(c.ctrlKey){a|=4}return(a)}else{if(b){return _pss_(b)}}return null}function _gkc_(b,a){if(b&&b.getKey){return(b.getKey())}if(a&&a.getKey){return(a.getKey())}if(a.browserEvent){return a.browserEvent.keyCode}return null}function _hdmask_(f,c){if(typeof f=="object"&&f){if(!f.hasMask){return}if(f.noAutoHide&&c!==true){return}f.noAutoHide=false;var b=0;if(typeof f.UIMask=="object"){if(f.UICnt){b=f.UICnt}if(--b<=0){f.UICnt=0;f.hasMask=false;var a=f.UIMask;if(a.mustWaitData!==true){f.maskActive=false;try{a.hide();a.destroy()}catch(d){_log("_hdmask_: "+d.message)}}f.UIMask=undefined}else{f.UICnt=b}}}}function createMask(a){return null}function _hfm_(b,a){if(b&&b.uniFMask){if(a.e&&b.uniFMask[a.e]){return true}}return false}function _shmask_(h,f,j,d){var b="Loading...";var c=0;var k=null;var a=false;var i=null;if(typeof h=="object"&&h){if(Ext.isObject(d)){i=d}else{if(Ext.isObject(h.uniMask)){i=h.uniMask}else{if(h.config&&Ext.isObject(h.config.uniMask)){i=h.config.uniMask}}}if(i&&(i.ldMask||f)){if(typeof i.maskMsg=="string"&&i.maskMsg!=""){b=i.maskMsg}if(h.UICnt!=undefined){c=h.UICnt}h.noAutoHide=j;try{if(c++==0){if(typeof i.targetObj=="object"&&i.targetObj){k=i.targetObj}else{if(h.uwindow&&h.uwindow.hidden!==true){k=h.uwindow}else{if(h.uform){k=h.uform}}}if(k){if(k.uform==k){a=true}if(!a&&k.getMaskTarget&&!k.getMaskTarget()){a=true}}try{h.UIMask=createMask({useTargetEl:a,target:k,msg:b,uniAttribs:i.maskAttribs,useMsg:i.maskUseMsg});h.UIMask.show()}catch(g){_log("_shmask_(): "+g)}}}finally{h.UICnt=c;h.hasMask=true;if(i.maskWaitData){uniVars._maskObjs.push({cf:i,c:0,u:h.UIMask})}}}}}function _ssevt_(d,c,a){if(!d.hasListeners){d.hasListeners={}}d.hasListeners[c]=!a;if(!d.uniSuspendedEvents){d.uniSuspendedEvents={}}d.uniSuspendedEvents[c]=a}function _hreq_(d,a,c){if(d&&d.exEvents){var b=d.exEvents.ajaxrequest;if(b){b(d,a,c)}}}function _hcbk_(c,b){if(c&&c.exEvents){var a=c.exEvents.ajaxcallback;if(a){a(c,b)}}}function _aexc_(a){var b=a.responseText;if(b&&b.substring(0,3)=="@@@"){a.responseText=b.substring(3);return(true)}return(false)}function obj2str(i,f,d,b){var a="",h=encodeURIComponent;if(!d){d="="}if(!b){b="&"}if(Ext.isObject(i)){for(var c in i){a=a+b+h(c)+d;var g=_xl_(i[c]);if(f){a=a+btoa(g)}else{a=a+g}}}if(f){a=btoa(a)}return a}function ajaxRequest(k,a,d,f,m){var n="",l=encodeURIComponent,b=f;if(!k){return null}if(!k.owner){return null}if(b==undefined&&uniVars._uniAsync===false){b=false}if(Ext.isObject(d)){n=obj2str(d)}else{if(d&&d.length){var j=d.length;for(var g=0;g<j;g++){n=n+"&"+l(d[g])}}}if(k.getXType&&k.getXType()=="combo"){_asst_(k)}var h="Ajax=1&IsEvent=1&Obj="+k.nm+"&Evt="+a+n+_gv_(k.uform);if(b!==false){b=true}var c=k.isXType&&k.isXType("window");if(m&&k.showMask&&!(!c&&k.uniMask&&k.uniMask.ldMask)){k.mevent=a;_shmask_(k,true)}return Ext.Ajax.request({url:k.owner.appRoot+"HandleEvent",event:a,params:h,success:k.owner.ajxS,failure:k.owner.ajxF,obj:k,async:b})}function _cdo_(g,c,f,b,d){if(b){if(f){if(g){if(!b[g]){b[g]={}}var a=b[g]}else{var a=b}a.owner=b;a[f]=c;c.uname=f}else{if(g){c.uname=g;b[g]=c}}c.owner=b;c.uform=b.form;c.uwindow=b.window;if(b.form&&b.window&&!b.window.uform){b.window.uform=b.form;b.window.uwindow=b.window}}else{if(c){_ueval(g+"="+c.nm+";")}else{_ueval(g+"={};")}_ueval(g+'.uname="'+g+'";')}if(c){c.monitorUniEvents=true;c.retfalse={};if(c.uniAfterCreate){c.uniAfterCreate()}if(d){d(c)}}}function _coe_(b,g,h,f,d){var c="On"+f.charAt(0).toUpperCase()+f.substring(1);var a=null;if(g){if(h){a=b[g][h]}else{a=b[g]}}else{if(h){a=b[h]}else{a=b}}if(a.on){a.on(f,d)}a[c]=d}function _coxe_(a,f,g,c,b){if(f){if(g){var d=a[f][g]}else{var d=a[f]}}else{if(g){var d=a[g]}else{var d=a}}if(!d.exEvents){d.exEvents=[]}d.exEvents[c]=b}function _gv_(c){var a="";if(c){if(c.getForm){var b=c.getForm()}else{var b=c}a=uniGetValues(b)}if(a!=""){return('&"_fp_='+_S_ID+a+'"')}else{return("&"+_S_ID)}}function _sps_(c,g,d,f,b){if(b&&b.getPosition){var a=b.getPosition();if(g!==null){g+=a[0]}if(d!==null){d+=a[1]}}if(f){if(g!==null){c.setLeft(g)}if(d!==null){c.setTop(d)}}else{_ssevt_(c,"move",true);try{if(g!==null&&d!==null){c.setPosition(g,d)}else{if(g===null){c.setLocalY(d)}else{if(d===null){c.setLocalX(g)}}}}finally{_ssevt_(c,"move",false)}}}function _ssz_(d,a,b){if(d.getCollapsed){var f=d.getCollapsed();if(f=="left"||f=="right"){if(d.sizeLocked!==true){if(a!=d.getWidth()){d.expand(false)}}}if(f=="top"||f=="bottom"){if(d.sizeLocked!==true){if(b!=d.getHeight()){d.expand(false)}}}}d.setSize(a,b)}Ext.override(Ext.Component,{constructor:function(a){if(a&&a.beforeinit){a.beforeinit(this,a)}this.callParent([a])},uniCleanup:function(){try{if(this.nm){eval("delete "+this.nm+";");if(this===uniVars._actCnt){uniVars._actCnt=null}if(this===uniVars._mFrm_){uniVars._mFrm_=null}if(this===uniVars._actFrm_){uniVars._actFrm_=uniVars._mFrm_}}}catch(e){}},uniAfterCreate:function(){},uniCheckEvent:function(a){if(this.events[a]===true){this.uniHasEvent[a]=true}},destroy:function(){var a=this.isDestroyed;if(!a&&this.manualDestroy===true){return}try{this.uniDestroy()}finally{try{this.callParent()}finally{if(!a){this.uniCleanup()}}}},uniDestroy:function(){if(!this.isDestroyed){if(this.uform&&this.uform.tabItems){this.uform.tabItems.remove(this);if(this.uform.activeField===this){this.uform.activeField=null}}if(this.owner){if(this.rootObj){eval("delete "+this.owner.uname+";")}else{if(this.uname){this.owner[this.uname]=null}}}}},setPendingElProps:function(){if(this.elArray){var b=this.elArray;while(b.length>0){e=b.pop();this.setElProp(e.prop,e.val,e.mtd,e.cs,true,e.elname)}}},afterRender:function(){var a=this;a.callParent();a.initUniEvents();a.setPendingElProps()},initUniEvents:function(){},showMaskCfg:function(a,b){if(!this.maskActive){_shmask_(this,true,b,a);this.maskActive=true}},showMask:function(d,c,b){if(!this.maskActive){var a=this;if(d){a.maskMsg=d;a.maskUseMsg=true}if(c){a.targetObj=c}else{if(this.uform){a.targetObj=this.uform}}_shmask_(this,true,b,a);this.maskActive=true}},hideMask:function(a){this.maskActive=false;_hdmask_(this,a)},setElProp:function(b,f,n,j,m,k){var d=null;switch(n){case 0:case 1:case 2:case 3:case 4:case 5:if(k){var l=k.split(".");if(l.length>1){d=this[l[0]];if(d){d=d[l[1]]}}else{d=this[k]}if(Ext.isObject(d)&&d.isComponent){d=d.el}}else{if(this.getEl){d=this.getEl()}else{d=this.element}}break;case 6:if(this.getComponent){d=this.getComponent().element}break}if(d){switch(n){case 0:d.setStyle(b,f);break;case 1:d=d.down(j);if(d){d.setStyle(b,f)}break;case 2:if(d.dom){d.dom[b]=f}break;case 3:if(d.dom&&d.dom.style){d.dom.style[b]=f}break;case 4:if(this.setFieldStyle){if(f){this.setFieldStyle(b+":"+f)}else{this.setFieldStyle(b)}}break;case 5:var h=Ext.DomQuery.select(j,d.dom,null,false);if(h&&h.length){for(var g=0;g<h.length;g++){if(Ext.isObject(b)){for(var c in b){if(h[g].style){h[g].style[c]=b[c]}}}}}break;case 6:d=d.down(j);if(d){d=d.dom}if(d){d[b]=f}break}}if(!d&&m!==true){if(this.elArray==undefined){this.elArray=[]}this.elArray.push({prop:b,val:f,mtd:n,cs:j,elname:k})}},setBodyProp:function(c,b){var a=this.body;if(a){a.setStyle(c,b)}}});var _ajxerr=false;var _showAjaxErr=false;var _ajxflerr="Server unavailable, please try later";function AjaxError(a,b){if(_ajxerr){return}_ajxerr=true;Ext.Msg.show({title:"Ajax Error",multiline:true,value:b,width:400,minWidth:200,msg:a,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK,fn:function(){_ajxerr=false}})}function AjaxSuccess(rs){if(_aexc_(rs)){return}try{eval(rs.responseText)}catch(err){if(_showAjaxErr){AjaxError(err.message,rs.responseText)}else{_log("JS Error: "+err.message)}}}function AjaxFailure(a,b){if(!uniSyncObj.fMode){AjaxError(_ajxflerr,"Error: "+a.statusText+"\x0AStatus: "+a.status)}}function _cunld_(){if(uniVars._mFrm_){ajaxRequest(uniVars._mFrm_,"bclose",[],false)}}function _sdl_(g){var a=uniVars._dlfrmarr;var c=a.length;if(c>=5){var b=a[0];a.shift();try{Ext.destroy(b)}catch(f){}}var d=Ext.DomHelper.append(document.body,{tag:"iframe","class":"x-hidden",id:"__uniDlFrame_"+uniVars._dlfrmid++,name:"???????",frameBorder:0,width:0,height:0,css:"display:none;visibility:hidden;height:0px;",src:g},true);a.push(d);return d}function _clat_(){for(var a in uniVars._timers){if(uniVars._timers[a]!=null){try{uniVars._timers[a].uniStop();uniVars._timers[a]=null}catch(b){}}}}function _hed_(b){var a=_gmo_(b);if(a.nm){a.uniBlurChanged=true;if(!a.sendBusy){if(!a.fieldEdited){if(a.getValue&&a.getValue()==null){return}a.fieldEdited=true;a.fieldEditBusy=true;try{if(a.readOnly!==true){if(a.uname){_sfc_(a);a.fireEvent("edited",a)}}}finally{a.fieldEditBusy=false}}}}}function _gmo_(a){if(!a.nm&&a.ownerCt&&a.ownerCt.nm){a=a.ownerCt}return a}function _ffc_(c,a,b){if(c&&c.focus){_sfc_(c,true);if(!a){a=false}if(!Ext.isNumber(b)){b=100}c.focus(a,b)}}function _sfc_(b,a){if(b&&!b.focusDisabled||a){uniVars._actCnt=b}}function _rfes_(a){a.fieldEdited=false}Ext.define("uniIFrame",{getEditorBody:function(){var a=this.getDoc();return a.body||a.documentElement},getDoc:function(){return Ext.isIE?this.getWin().document:(this.iframe.contentDocument||this.getWin().document)},getWin:function(){return Ext.isIE?this.iframe.contentWindow:window.frames[this.iframe.name]},setUrl:function(a){this.lastUrl=a;if(this.iframe){this.iframe.src=a;this.fireEvent("urlchange",this,this.iframe)}},setValue:function(c,a){if(this.docInited){if(a===true){this.getEditorBody().innerHTML=c}else{var b=this.getDoc();b.open();b.writeln(c);b.close()}}else{this.fhtml=c;this.fhtmlOnly=a}},initEditor:function(){this.docInited=true;if(this.fhtml){this.setValue(this.fhtml,this.fhtmlOnly)}},initIFrame:function(c,b){if(this.iframe==undefined){var a=this.ifName;if(!a){a=this.config.ifName}if(a){this.iframe=document.getElementsByName(a)[0];if(this.iframe&&this.lastUrl){this.setUrl(this.lastUrl)}}}if(c&&this.lastUrl){this.fireEvent("frameload",this,b)}}});function nullVarToStr(a){if(a==undefined||a===null){return("")}return(a)}function varEqual(b,a){if(b===a){return true}if(Ext.isNumber(b)||Ext.isNumber(a)){if(b==a){return true}}if(Ext.isDate(b)||Ext.isDate(a)){if(_dts_(b)==_dts_(a)){return true}}if(nullVarToStr(b)==nullVarToStr(a)){return true}return false}function _o2s_(g,c){var d="\4",b="",a,h;if(!Ext.isObject(g)){return(_xl_(g))}for(var f in g){a=g[f];if(c){h=c[f];if(varEqual(a,h)){continue}}a=_xl_(a);if(b!=""){b+=d}b=b+f+"="+a}return"{"+b+"}"}function _r2s_(c){var b="{";if(!Ext.isObject(c)){return(_xl_(c))}if(c.data){var f=c.data;for(var d in f){if(c.isModified(d)){var a=_xl_(f[d]);if(b!="{"){b+=","}b=b+d+":"+a}}}return b+"}"}function iframe_load(a){var b=Ext.getCmp(a);if(b){b.initIFrame(true,this)}}function _rno2arr_(b){if(!Ext.isArray(b)){return("")}var a="[";Ext.Array.each(b,function(d){a+=d.data._r+","});a=a.slice(0,-1);a+="]";return(a)}function svg2png(d,l,g,a){var j;if(d.el){j=d.el.down("svg",true)}if(j){var b=document.createElement("canvas");b.height=g;b.width=l;var i=new XMLSerializer().serializeToString(j);var k=btoa(i);var f="data:image/svg+xml;base64,";var m=f+k;var c=new Image;c.onload=function(){b.getContext("2d").drawImage(c,0,0);var h=b.toDataURL("image/png");ajaxRequest(d,a,{png:h});delete b};c.src=m}}function setStoreRow(a,h,b,g,f){if(a.getCount&&a.getCount()===0){return}var d=a.getById(h);if(!d){d=a.getById(b)}if(d){d.noEvent=true;try{d.set(g);d.setId(h);d.commit()}finally{d.noEvent=false}}else{if(f){var c="";if(a.grid){c=a.grid.uname}alert("setStoreRow(): Row not found, Id: "+h+" Grid: "+c)}}}Ext.override(Ext.data.Store,{uniApplyId:function(a,c){if(a.length==1&&Ext.isNumber(c)){var b=a[0];b.setId(c)}},uniAdd:function(a){var b=this,d=a.id;var c=b.add(a);b.uniApplyId(c,d);return c},uniInsert:function(b,a){var c=this,f=a.id;var d=c.insert(b,a);c.uniApplyId(d,f);return d}});